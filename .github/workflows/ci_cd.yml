# .github/workflows/ci_cd.yml
name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
    tags: [ 'v*' ]
  pull_request:
    branches: [ main, develop ]

env:
  FLUTTER_VERSION: '3.35.4'
  BUNDLE_ID_ANDROID: ${{ secrets.BUNDLE_ID_ANDROID || 'com.suleymansurucu.sarababy' }}
  BUNDLE_ID_IOS: ${{ secrets.BUNDLE_ID_IOS || 'com.suleymansurucu.babysara' }}
  SUPPORTED_LOCALES: 'en-US,tr-TR,ar-SA,de-DE,es-ES,fr-FR,id-ID,ko-KR,nl-NL,ru-RU,zh-TW'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          cache: true

      - name: Cache Flutter dependencies
        uses: actions/cache@v3
        with:
          path: |
            ~/.pub-cache
            **/.packages
            **/.flutter-plugins
            **/.flutter-plugin-dependencies
          key: ${{ runner.os }}-flutter-${{ hashFiles('**/pubspec.lock') }}
          restore-keys: |
            ${{ runner.os }}-flutter-

      - name: Install dependencies
        run: flutter pub get

      # Setup Firebase configuration
      - name: Setup Firebase configuration
        run: |
          echo "üî• Setting up Firebase configuration..."
          # Create firebase_options.dart if it doesn't exist
          if [ ! -f "lib/firebase_options.dart" ]; then
            echo "‚ö†Ô∏è firebase_options.dart not found, creating minimal version..."
            mkdir -p lib
            echo "// File generated by FlutterFire CLI." > lib/firebase_options.dart
            echo "// ignore_for_file: type=lint" >> lib/firebase_options.dart
            echo "import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;" >> lib/firebase_options.dart
            echo "import 'package:flutter/foundation.dart' show defaultTargetPlatform, kIsWeb, TargetPlatform;" >> lib/firebase_options.dart
            echo "" >> lib/firebase_options.dart
            echo "/// Default [FirebaseOptions] for use with your Firebase apps." >> lib/firebase_options.dart
            echo "class DefaultFirebaseOptions {" >> lib/firebase_options.dart
            echo "  static FirebaseOptions get currentPlatform {" >> lib/firebase_options.dart
            echo "    if (kIsWeb) return web;" >> lib/firebase_options.dart
            echo "    switch (defaultTargetPlatform) {" >> lib/firebase_options.dart
            echo "      case TargetPlatform.android: return android;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.iOS: return ios;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.macOS: return macos;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.windows: return windows;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.linux: throw UnsupportedError('DefaultFirebaseOptions have not been configured for linux');" >> lib/firebase_options.dart
            echo "      default: throw UnsupportedError('DefaultFirebaseOptions are not supported for this platform');" >> lib/firebase_options.dart
            echo "    }" >> lib/firebase_options.dart
            echo "  }" >> lib/firebase_options.dart
            echo "" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions web = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:web:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions android = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:android:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions ios = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:ios:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions macos = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:ios:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions windows = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:web:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "}" >> lib/firebase_options.dart
          fi

      # Validate localization files
      - name: Validate localization files
        run: |
          echo "üîç Validating localization files..."
          for locale in $(echo "${{ env.SUPPORTED_LOCALES }}" | tr ',' ' '); do
            if [ -f "lib/l10n/${locale}.json" ]; then
              echo "‚úÖ Found: ${locale}.json"
              python3 -m json.tool "lib/l10n/${locale}.json" > /dev/null
            else
              echo "‚ùå Missing: ${locale}.json"
              exit 1
            fi
          done
          echo "üéâ All localization files are valid!"

      - name: Run tests
        run: flutter test --coverage

      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: coverage/lcov.info

      - name: Analyze code
        run: |
          echo "üîç Analyzing code..."
          flutter analyze || true
          echo "‚úÖ Code analysis completed (warnings are acceptable)"

      - name: Format code
        run: |
          echo "üé® Formatting code..."
          dart format .
          echo "‚úÖ Code formatting completed"

  # Development build for develop branch
  build-development:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/develop'

    steps:
      - uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          cache: true

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'

      - name: Cache Flutter dependencies
        uses: actions/cache@v3
        with:
          path: |
            ~/.pub-cache
            **/.packages
            **/.flutter-plugins
            **/.flutter-plugin-dependencies
          key: ${{ runner.os }}-flutter-${{ hashFiles('**/pubspec.lock') }}
          restore-keys: |
            ${{ runner.os }}-flutter-

      - name: Install dependencies
        run: flutter pub get

      # Setup Firebase configuration
      - name: Setup Firebase configuration
        run: |
          echo "üî• Setting up Firebase configuration..."
          # Create firebase_options.dart if it doesn't exist
          if [ ! -f "lib/firebase_options.dart" ]; then
            echo "‚ö†Ô∏è firebase_options.dart not found, creating minimal version..."
            mkdir -p lib
            echo "// File generated by FlutterFire CLI." > lib/firebase_options.dart
            echo "// ignore_for_file: type=lint" >> lib/firebase_options.dart
            echo "import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;" >> lib/firebase_options.dart
            echo "import 'package:flutter/foundation.dart' show defaultTargetPlatform, kIsWeb, TargetPlatform;" >> lib/firebase_options.dart
            echo "" >> lib/firebase_options.dart
            echo "/// Default [FirebaseOptions] for use with your Firebase apps." >> lib/firebase_options.dart
            echo "class DefaultFirebaseOptions {" >> lib/firebase_options.dart
            echo "  static FirebaseOptions get currentPlatform {" >> lib/firebase_options.dart
            echo "    if (kIsWeb) return web;" >> lib/firebase_options.dart
            echo "    switch (defaultTargetPlatform) {" >> lib/firebase_options.dart
            echo "      case TargetPlatform.android: return android;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.iOS: return ios;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.macOS: return macos;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.windows: return windows;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.linux: throw UnsupportedError('DefaultFirebaseOptions have not been configured for linux');" >> lib/firebase_options.dart
            echo "      default: throw UnsupportedError('DefaultFirebaseOptions are not supported for this platform');" >> lib/firebase_options.dart
            echo "    }" >> lib/firebase_options.dart
            echo "  }" >> lib/firebase_options.dart
            echo "" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions web = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:web:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions android = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:android:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions ios = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:ios:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions macos = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:ios:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions windows = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:web:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "}" >> lib/firebase_options.dart
          fi
          
          # Create google-services.json if it doesn't exist
          if [ ! -f "android/app/google-services.json" ]; then
            echo "‚ö†Ô∏è google-services.json not found, creating minimal version..."
            mkdir -p android/app
            echo '{' > android/app/google-services.json
            echo '  "project_info": {' >> android/app/google-services.json
            echo '    "project_number": "123456789",' >> android/app/google-services.json
            echo '    "project_id": "demo-project",' >> android/app/google-services.json
            echo '    "storage_bucket": "demo-project.appspot.com"' >> android/app/google-services.json
            echo '  },' >> android/app/google-services.json
            echo '  "client": [' >> android/app/google-services.json
            echo '    {' >> android/app/google-services.json
            echo '      "client_info": {' >> android/app/google-services.json
            echo '        "mobilesdk_app_id": "1:123456789:android:demo",' >> android/app/google-services.json
            echo '        "android_client_info": {' >> android/app/google-services.json
            echo '          "package_name": "com.suleymansurucu.sarababy"' >> android/app/google-services.json
            echo '        }' >> android/app/google-services.json
            echo '      },' >> android/app/google-services.json
            echo '      "oauth_client": [],' >> android/app/google-services.json
            echo '      "api_key": [' >> android/app/google-services.json
            echo '        {' >> android/app/google-services.json
            echo '          "current_key": "demo-api-key"' >> android/app/google-services.json
            echo '        }' >> android/app/google-services.json
            echo '      ],' >> android/app/google-services.json
            echo '      "services": {' >> android/app/google-services.json
            echo '        "appinvite_service": {' >> android/app/google-services.json
            echo '          "other_platform_oauth_client": []' >> android/app/google-services.json
            echo '        }' >> android/app/google-services.json
            echo '      }' >> android/app/google-services.json
            echo '    }' >> android/app/google-services.json
            echo '  ],' >> android/app/google-services.json
            echo '  "configuration_version": "1"' >> android/app/google-services.json
            echo '}' >> android/app/google-services.json
          fi
          
          # Copy splash.png to drawable-v21 directory
          echo "üì± Copying splash.png to drawable-v21 directory..."
          mkdir -p android/app/src/main/res/drawable-v21
          cp android/app/src/main/res/drawable/splash.png android/app/src/main/res/drawable-v21/splash.png
          echo "‚úÖ splash.png copied to drawable-v21"

      - name: Build Development APK
        run: |
          flutter build apk --debug \
            --build-name=dev-${{ github.event.head_commit.id }} \
            --build-number=${{ github.run_number }}

      - name: Upload Development APK
        uses: actions/upload-artifact@v4
        with:
          name: android-development-apk-${{ github.sha }}
          path: build/app/outputs/flutter-apk/app-debug.apk
          retention-days: 7

      - name: Build Development App Bundle
        run: |
          flutter build appbundle --debug \
            --build-name=dev-${{ github.event.head_commit.id }} \
            --build-number=${{ github.run_number }}

      - name: Upload Development App Bundle
        uses: actions/upload-artifact@v4
        with:
          name: android-development-bundle-${{ github.sha }}
          path: build/app/outputs/bundle/debug/app-debug.aab
          retention-days: 7

  # Production build for main branch and tags
  build-android:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' || startsWith(github.ref, 'refs/tags/v')

    steps:
      - uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          cache: true

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'

      - name: Cache Flutter dependencies
        uses: actions/cache@v3
        with:
          path: |
            ~/.pub-cache
            **/.packages
            **/.flutter-plugins
            **/.flutter-plugin-dependencies
          key: ${{ runner.os }}-flutter-${{ hashFiles('**/pubspec.lock') }}
          restore-keys: |
            ${{ runner.os }}-flutter-

      - name: Install dependencies
        run: flutter pub get

      # Setup Firebase configuration
      - name: Setup Firebase configuration
        run: |
          echo "üî• Setting up Firebase configuration..."
          # Create firebase_options.dart if it doesn't exist
          if [ ! -f "lib/firebase_options.dart" ]; then
            echo "‚ö†Ô∏è firebase_options.dart not found, creating minimal version..."
            mkdir -p lib
            echo "// File generated by FlutterFire CLI." > lib/firebase_options.dart
            echo "// ignore_for_file: type=lint" >> lib/firebase_options.dart
            echo "import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;" >> lib/firebase_options.dart
            echo "import 'package:flutter/foundation.dart' show defaultTargetPlatform, kIsWeb, TargetPlatform;" >> lib/firebase_options.dart
            echo "" >> lib/firebase_options.dart
            echo "/// Default [FirebaseOptions] for use with your Firebase apps." >> lib/firebase_options.dart
            echo "class DefaultFirebaseOptions {" >> lib/firebase_options.dart
            echo "  static FirebaseOptions get currentPlatform {" >> lib/firebase_options.dart
            echo "    if (kIsWeb) return web;" >> lib/firebase_options.dart
            echo "    switch (defaultTargetPlatform) {" >> lib/firebase_options.dart
            echo "      case TargetPlatform.android: return android;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.iOS: return ios;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.macOS: return macos;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.windows: return windows;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.linux: throw UnsupportedError('DefaultFirebaseOptions have not been configured for linux');" >> lib/firebase_options.dart
            echo "      default: throw UnsupportedError('DefaultFirebaseOptions are not supported for this platform');" >> lib/firebase_options.dart
            echo "    }" >> lib/firebase_options.dart
            echo "  }" >> lib/firebase_options.dart
            echo "" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions web = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:web:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions android = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:android:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions ios = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:ios:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions macos = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:ios:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions windows = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:web:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "}" >> lib/firebase_options.dart
          fi
          
          # Create google-services.json if it doesn't exist
          if [ ! -f "android/app/google-services.json" ]; then
            echo "‚ö†Ô∏è google-services.json not found, creating minimal version..."
            mkdir -p android/app
            echo '{' > android/app/google-services.json
            echo '  "project_info": {' >> android/app/google-services.json
            echo '    "project_number": "123456789",' >> android/app/google-services.json
            echo '    "project_id": "demo-project",' >> android/app/google-services.json
            echo '    "storage_bucket": "demo-project.appspot.com"' >> android/app/google-services.json
            echo '  },' >> android/app/google-services.json
            echo '  "client": [' >> android/app/google-services.json
            echo '    {' >> android/app/google-services.json
            echo '      "client_info": {' >> android/app/google-services.json
            echo '        "mobilesdk_app_id": "1:123456789:android:demo",' >> android/app/google-services.json
            echo '        "android_client_info": {' >> android/app/google-services.json
            echo '          "package_name": "com.suleymansurucu.sarababy"' >> android/app/google-services.json
            echo '        }' >> android/app/google-services.json
            echo '      },' >> android/app/google-services.json
            echo '      "oauth_client": [],' >> android/app/google-services.json
            echo '      "api_key": [' >> android/app/google-services.json
            echo '        {' >> android/app/google-services.json
            echo '          "current_key": "demo-api-key"' >> android/app/google-services.json
            echo '        }' >> android/app/google-services.json
            echo '      ],' >> android/app/google-services.json
            echo '      "services": {' >> android/app/google-services.json
            echo '        "appinvite_service": {' >> android/app/google-services.json
            echo '          "other_platform_oauth_client": []' >> android/app/google-services.json
            echo '        }' >> android/app/google-services.json
            echo '      }' >> android/app/google-services.json
            echo '    }' >> android/app/google-services.json
            echo '  ],' >> android/app/google-services.json
            echo '  "configuration_version": "1"' >> android/app/google-services.json
            echo '}' >> android/app/google-services.json
          fi
          
          # Copy splash.png to drawable-v21 directory
          echo "üì± Copying splash.png to drawable-v21 directory..."
          mkdir -p android/app/src/main/res/drawable-v21
          cp android/app/src/main/res/drawable/splash.png android/app/src/main/res/drawable-v21/splash.png
          echo "‚úÖ splash.png copied to drawable-v21"

      - name: Decode keystore
        run: |
          echo "${{ secrets.KEYSTORE_BASE64 }}" | base64 --decode > android/app/keystore.jks

      - name: Create key.properties
        run: |
          echo "storePassword=${{ secrets.KEYSTORE_PASSWORD }}" >> android/key.properties
          echo "keyPassword=${{ secrets.KEY_PASSWORD }}" >> android/key.properties
          echo "keyAlias=${{ secrets.KEY_ALIAS }}" >> android/key.properties
          echo "storeFile=keystore.jks" >> android/key.properties

      - name: Build App Bundle
        run: |
          flutter build appbundle --release \
            --build-name=${{ github.event.head_commit.id }} \
            --build-number=${{ github.run_number }}

      - name: Build APK
        run: |
          flutter build apk --release \
            --build-name=${{ github.event.head_commit.id }} \
            --build-number=${{ github.run_number }}

      - name: Upload App Bundle
        uses: actions/upload-artifact@v4
        with:
          name: android-app-bundle-${{ github.sha }}
          path: build/app/outputs/bundle/release/app-release.aab
          retention-days: 30

      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: android-apk-${{ github.sha }}
          path: build/app/outputs/flutter-apk/app-release.apk
          retention-days: 30

  # .github/workflows/ci_cd.yml - Eklenecek job (satƒ±r 210'dan sonra)

  # iOS production build and deployment for main branch and tags
  build-ios-production:
    needs: test
    runs-on: macos-latest
    if: github.ref == 'refs/heads/main' || startsWith(github.ref, 'refs/tags/v')

    steps:
      - uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          cache: true

      - name: Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.0'
          bundler-cache: true

      - name: Cache Flutter dependencies
        uses: actions/cache@v3
        with:
          path: |
            ~/.pub-cache
            **/.packages
            **/.flutter-plugins
            **/.flutter-plugin-dependencies
          key: ${{ runner.os }}-flutter-${{ hashFiles('**/pubspec.lock') }}
          restore-keys: |
            ${{ runner.os }}-flutter-

      - name: Install dependencies
        run: flutter pub get

      # Setup Firebase configuration
      - name: Setup Firebase configuration
        run: |
          echo "üî• Setting up Firebase configuration..."
          echo "üìÅ Current directory: $(pwd)"
          echo "üìÅ Contents of current directory:"
          ls -la
          echo "üìÅ Contents of lib directory:"
          ls -la lib/ || echo "lib directory does not exist"
          
          # Create firebase_options.dart if it doesn't exist
          if [ ! -f "lib/firebase_options.dart" ]; then
            echo "‚ö†Ô∏è firebase_options.dart not found, creating minimal version..."
            mkdir -p lib
            echo "// File generated by FlutterFire CLI." > lib/firebase_options.dart
            echo "// ignore_for_file: type=lint" >> lib/firebase_options.dart
            echo "import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;" >> lib/firebase_options.dart
            echo "import 'package:flutter/foundation.dart' show defaultTargetPlatform, kIsWeb, TargetPlatform;" >> lib/firebase_options.dart
            echo "" >> lib/firebase_options.dart
            echo "/// Default [FirebaseOptions] for use with your Firebase apps." >> lib/firebase_options.dart
            echo "class DefaultFirebaseOptions {" >> lib/firebase_options.dart
            echo "  static FirebaseOptions get currentPlatform {" >> lib/firebase_options.dart
            echo "    if (kIsWeb) return web;" >> lib/firebase_options.dart
            echo "    switch (defaultTargetPlatform) {" >> lib/firebase_options.dart
            echo "      case TargetPlatform.android: return android;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.iOS: return ios;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.macOS: return macos;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.windows: return windows;" >> lib/firebase_options.dart
            echo "      case TargetPlatform.linux: throw UnsupportedError('DefaultFirebaseOptions have not been configured for linux');" >> lib/firebase_options.dart
            echo "      default: throw UnsupportedError('DefaultFirebaseOptions are not supported for this platform');" >> lib/firebase_options.dart
            echo "    }" >> lib/firebase_options.dart
            echo "  }" >> lib/firebase_options.dart
            echo "" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions web = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:web:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions android = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:android:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions ios = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:ios:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions macos = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:ios:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "  static const FirebaseOptions windows = FirebaseOptions(apiKey: 'demo-api-key', appId: '1:123456789:web:demo', messagingSenderId: '123456789', projectId: 'demo-project');" >> lib/firebase_options.dart
            echo "}" >> lib/firebase_options.dart
            echo "‚úÖ firebase_options.dart created successfully"
          else
            echo "‚úÖ firebase_options.dart already exists"
          fi
          
          echo "üìÅ Final contents of lib directory:"
          ls -la lib/
          echo "üìÑ Contents of firebase_options.dart:"
          cat lib/firebase_options.dart
          
          # Create GoogleService-Info.plist if it doesn't exist
          if [ ! -f "ios/Runner/GoogleService-Info.plist" ]; then
            echo "‚ö†Ô∏è GoogleService-Info.plist not found, creating minimal version..."
            mkdir -p ios/Runner
            echo '<?xml version="1.0" encoding="UTF-8"?>' > ios/Runner/GoogleService-Info.plist
            echo '<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">' >> ios/Runner/GoogleService-Info.plist
            echo '<plist version="1.0">' >> ios/Runner/GoogleService-Info.plist
            echo '<dict>' >> ios/Runner/GoogleService-Info.plist
            echo '	<key>API_KEY</key>' >> ios/Runner/GoogleService-Info.plist
            echo '	<string>demo-api-key</string>' >> ios/Runner/GoogleService-Info.plist
            echo '	<key>GCM_SENDER_ID</key>' >> ios/Runner/GoogleService-Info.plist
            echo '	<string>123456789</string>' >> ios/Runner/GoogleService-Info.plist
            echo '	<key>PLIST_VERSION</key>' >> ios/Runner/GoogleService-Info.plist
            echo '	<string>1</string>' >> ios/Runner/GoogleService-Info.plist
            echo '	<key>BUNDLE_ID</key>' >> ios/Runner/GoogleService-Info.plist
            echo '	<string>com.suleymansurucu.sarababy</string>' >> ios/Runner/GoogleService-Info.plist
            echo '	<key>PROJECT_ID</key>' >> ios/Runner/GoogleService-Info.plist
            echo '	<string>demo-project</string>' >> ios/Runner/GoogleService-Info.plist
            echo '	<key>STORAGE_BUCKET</key>' >> ios/Runner/GoogleService-Info.plist
            echo '	<string>demo-project.appspot.com</string>' >> ios/Runner/GoogleService-Info.plist
            echo '	<key>IS_ADS_ENABLED</key>' >> ios/Runner/GoogleService-Info.plist
            echo '	<false></false>' >> ios/Runner/GoogleService-Info.plist
            echo '	<key>IS_ANALYTICS_ENABLED</key>' >> ios/Runner/GoogleService-Info.plist
            echo '	<false></false>' >> ios/Runner/GoogleService-Info.plist
            echo '	<key>IS_APPINVITE_ENABLED</key>' >> ios/Runner/GoogleService-Info.plist
            echo '	<true></true>' >> ios/Runner/GoogleService-Info.plist
            echo '	<key>IS_GCM_ENABLED</key>' >> ios/Runner/GoogleService-Info.plist
            echo '	<true></true>' >> ios/Runner/GoogleService-Info.plist
            echo '	<key>IS_SIGNIN_ENABLED</key>' >> ios/Runner/GoogleService-Info.plist
            echo '	<true></true>' >> ios/Runner/GoogleService-Info.plist
            echo '	<key>GOOGLE_APP_ID</key>' >> ios/Runner/GoogleService-Info.plist
            echo '	<string>1:123456789:ios:demo</string>' >> ios/Runner/GoogleService-Info.plist
            echo '</dict>' >> ios/Runner/GoogleService-Info.plist
            echo '</plist>' >> ios/Runner/GoogleService-Info.plist
          fi

      - name: Install Fastlane
        run: |
          cd ios
          bundle install

      # API key dosyasƒ±nƒ± secret'tan olu≈ütur
      - name: Setup API Key
        run: |
          cd ios
          echo "${{ secrets.APP_STORE_CONNECT_API_KEY }}" > AuthKey_${{ secrets.APP_STORE_CONNECT_API_KEY_ID || 'T793NZB3B5' }}.p8

      - name: Build and Deploy iOS
        env:
          BUNDLE_ID_IOS: ${{ secrets.BUNDLE_ID_IOS || 'com.suleymansurucu.babysara' }}
          APPLE_ID: ${{ secrets.APPLE_ID || 'suleymansurucu95@icloud.com' }}
          APPLE_TEAM_ID: ${{ secrets.APPLE_TEAM_ID || '3588AF9993' }}
          APP_STORE_CONNECT_TEAM_ID: ${{ secrets.APP_STORE_CONNECT_TEAM_ID || '3588AF9993' }}
          APP_STORE_CONNECT_API_KEY_ID: ${{ secrets.APP_STORE_CONNECT_API_KEY_ID || 'T793NZB3B5' }}
          APP_STORE_CONNECT_ISSUER_ID: ${{ secrets.APP_STORE_CONNECT_ISSUER_ID || 'bd3d7716-83ab-4e9a-9a30-a77ec9bc8b9f' }}
        run: |
          cd ios
          bundle exec fastlane release

      - name: Upload iOS Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: ios-production-build-${{ github.sha }}
          path: ios/build/
          retention-days: 30

  # iOS deployment notification
  notify-ios-deployment:
    needs: [build-ios-production, generate-release-notes]
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
      - name: iOS Deployment Complete
        run: |
          echo "üçé iOS deployment completed successfully!"
          echo "üì± App uploaded to App Store Connect"
          echo "üîó Check App Store Connect for processing status"
          echo "üìã Commit: ${{ github.sha }}"
          echo "üåø Branch: main"
          echo "üåç Release notes available in 11 languages"

  # Multilanguage Release Notes Generation
  generate-release-notes:
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/tags/v')
    outputs:
      release-notes-en: ${{ steps.generate-notes.outputs.notes-en }}
      release-notes-tr: ${{ steps.generate-notes.outputs.notes-tr }}
      release-notes-ar: ${{ steps.generate-notes.outputs.notes-ar }}
      release-notes-de: ${{ steps.generate-notes.outputs.notes-de }}
      release-notes-es: ${{ steps.generate-notes.outputs.notes-es }}
      release-notes-fr: ${{ steps.generate-notes.outputs.notes-fr }}
      release-notes-id: ${{ steps.generate-notes.outputs.notes-id }}
      release-notes-ko: ${{ steps.generate-notes.outputs.notes-ko }}
      release-notes-nl: ${{ steps.generate-notes.outputs.notes-nl }}
      release-notes-ru: ${{ steps.generate-notes.outputs.notes-ru }}
      release-notes-zh: ${{ steps.generate-notes.outputs.notes-zh }}

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Generate Multilanguage Release Notes
        id: generate-notes
        run: |
          # Find last tag
          LAST_TAG=$(git describe --tags --abbrev=0 HEAD^ 2>/dev/null || echo "")
          
          if [ -z "$LAST_TAG" ]; then
            COMMITS=$(git log --pretty=format:"- %s (%h)" --no-merges)
          else
            COMMITS=$(git log ${LAST_TAG}..HEAD --pretty=format:"- %s (%h)" --no-merges)
          fi
          
          VERSION=$(echo "${{ github.ref_name }}" | sed 's/v//')
          
          # English Release Notes
          cat > release_notes_en.md << EOF
          ## üöÄ Version $VERSION
          
          ### ‚ú® New Features
          $(echo "$COMMITS" | grep -E "^(feat|‚ú®)" || echo "- New features added")
          
          ### üêõ Bug Fixes
          $(echo "$COMMITS" | grep -E "^(fix|üêõ)" || echo "- Bug fixes implemented")
          
          ### üîß Improvements
          $(echo "$COMMITS" | grep -E "^(perf|refactor|üöÄ|üîß)" || echo "- Performance improvements")
          
          ### üåç Multi-Language Support
          - 11 different languages supported: Turkish, English, Arabic, German, Spanish, French, Indonesian, Korean, Dutch, Russian, Traditional Chinese
          
          ### üì± Platform Support
          - Android (API 23+)
          - iOS (iOS 12+)
          
          ---
          **Full changelog:** [CHANGELOG.MD](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.MD)
          EOF
          
          # Turkish Release Notes
          cat > release_notes_tr.md << EOF
          ## üöÄ S√ºr√ºm $VERSION
          
          ### ‚ú® Yeni √ñzellikler
          $(echo "$COMMITS" | grep -E "^(feat|‚ú®)" || echo "- Yeni √∂zellikler eklendi")
          
          ### üêõ Hata D√ºzeltmeleri
          $(echo "$COMMITS" | grep -E "^(fix|üêõ)" || echo "- Hata d√ºzeltmeleri yapƒ±ldƒ±")
          
          ### üîß ƒ∞yile≈ütirmeler
          $(echo "$COMMITS" | grep -E "^(perf|refactor|üöÄ|üîß)" || echo "- Performans iyile≈ütirmeleri")
          
          ### üåç √áoklu Dil Desteƒüi
          - 11 farklƒ± dil desteƒüi: T√ºrk√ße, ƒ∞ngilizce, Arap√ßa, Almanca, ƒ∞spanyolca, Fransƒ±zca, Endonezce, Korece, Hollandaca, Rus√ßa, Geleneksel √áince
          
          ### üì± Platform Desteƒüi
          - Android (API 23+)
          - iOS (iOS 12+)
          
          ---
          **Tam deƒüi≈üiklik listesi:** [CHANGELOG.MD](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.MD)
          EOF
          
          # Arabic Release Notes
          cat > release_notes_ar.md << EOF
          ## üöÄ ÿßŸÑÿ•ÿµÿØÿßÿ± $VERSION
          
          ### ‚ú® ŸÖŸäÿ≤ÿßÿ™ ÿ¨ÿØŸäÿØÿ©
          $(echo "$COMMITS" | grep -E "^(feat|‚ú®)" || echo "- ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸäÿ≤ÿßÿ™ ÿ¨ÿØŸäÿØÿ©")
          
          ### üêõ ÿ•ÿµŸÑÿßÿ≠ÿßÿ™ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°
          $(echo "$COMMITS" | grep -E "^(fix|üêõ)" || echo "- ÿ™ŸÖ ÿ•ÿµŸÑÿßÿ≠ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°")
          
          ### üîß ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™
          $(echo "$COMMITS" | grep -E "^(perf|refactor|üöÄ|üîß)" || echo "- ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿßŸÑÿ£ÿØÿßÿ°")
          
          ### üåç ÿØÿπŸÖ ŸÖÿ™ÿπÿØÿØ ÿßŸÑŸÑÿ∫ÿßÿ™
          - ÿØÿπŸÖ 11 ŸÑÿ∫ÿ© ŸÖÿÆÿ™ŸÑŸÅÿ©: ÿßŸÑÿ™ÿ±ŸÉŸäÿ©ÿå ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©ÿå ÿßŸÑÿπÿ±ÿ®Ÿäÿ©ÿå ÿßŸÑÿ£ŸÑŸÖÿßŸÜŸäÿ©ÿå ÿßŸÑÿ•ÿ≥ÿ®ÿßŸÜŸäÿ©ÿå ÿßŸÑŸÅÿ±ŸÜÿ≥Ÿäÿ©ÿå ÿßŸÑÿ•ŸÜÿØŸàŸÜŸäÿ≥Ÿäÿ©ÿå ÿßŸÑŸÉŸàÿ±Ÿäÿ©ÿå ÿßŸÑŸáŸàŸÑŸÜÿØŸäÿ©ÿå ÿßŸÑÿ±Ÿàÿ≥Ÿäÿ©ÿå ÿßŸÑÿµŸäŸÜŸäÿ© ÿßŸÑÿ™ŸÇŸÑŸäÿØŸäÿ©
          
          ### üì± ÿØÿπŸÖ ÿßŸÑŸÖŸÜÿµÿßÿ™
          - Android (API 23+)
          - iOS (iOS 12+)
          
          ---
          **ÿ≥ÿ¨ŸÑ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ÿßŸÑŸÉÿßŸÖŸÑ:** [CHANGELOG.MD](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.MD)
          EOF
          
          # German Release Notes
          cat > release_notes_de.md << EOF
          ## üöÄ Version $VERSION
          
          ### ‚ú® Neue Funktionen
          $(echo "$COMMITS" | grep -E "^(feat|‚ú®)" || echo "- Neue Funktionen hinzugef√ºgt")
          
          ### üêõ Fehlerbehebungen
          $(echo "$COMMITS" | grep -E "^(fix|üêõ)" || echo "- Fehler behoben")
          
          ### üîß Verbesserungen
          $(echo "$COMMITS" | grep -E "^(perf|refactor|üöÄ|üîß)" || echo "- Leistungsverbesserungen")
          
          ### üåç Mehrsprachige Unterst√ºtzung
          - 11 verschiedene Sprachen unterst√ºtzt: T√ºrkisch, Englisch, Arabisch, Deutsch, Spanisch, Franz√∂sisch, Indonesisch, Koreanisch, Niederl√§ndisch, Russisch, Traditionelles Chinesisch
          
          ### üì± Plattform-Unterst√ºtzung
          - Android (API 23+)
          - iOS (iOS 12+)
          
          ---
          **Vollst√§ndiges √Ñnderungsprotokoll:** [CHANGELOG.MD](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.MD)
          EOF
          
          # Spanish Release Notes
          cat > release_notes_es.md << EOF
          ## üöÄ Versi√≥n $VERSION
          
          ### ‚ú® Nuevas Caracter√≠sticas
          $(echo "$COMMITS" | grep -E "^(feat|‚ú®)" || echo "- Nuevas caracter√≠sticas a√±adidas")
          
          ### üêõ Correcciones de Errores
          $(echo "$COMMITS" | grep -E "^(fix|üêõ)" || echo "- Errores corregidos")
          
          ### üîß Mejoras
          $(echo "$COMMITS" | grep -E "^(perf|refactor|üöÄ|üîß)" || echo "- Mejoras de rendimiento")
          
          ### üåç Soporte Multiidioma
          - 11 idiomas diferentes soportados: Turco, Ingl√©s, √Årabe, Alem√°n, Espa√±ol, Franc√©s, Indonesio, Coreano, Holand√©s, Ruso, Chino Tradicional
          
          ### üì± Soporte de Plataformas
          - Android (API 23+)
          - iOS (iOS 12+)
          
          ---
          **Registro de cambios completo:** [CHANGELOG.MD](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.MD)
          EOF
          
          # French Release Notes
          cat > release_notes_fr.md << EOF
          ## üöÄ Version $VERSION
          
          ### ‚ú® Nouvelles Fonctionnalit√©s
          $(echo "$COMMITS" | grep -E "^(feat|‚ú®)" || echo "- Nouvelles fonctionnalit√©s ajout√©es")
          
          ### üêõ Corrections de Bugs
          $(echo "$COMMITS" | grep -E "^(fix|üêõ)" || echo "- Bugs corrig√©s")
          
          ### üîß Am√©liorations
          $(echo "$COMMITS" | grep -E "^(perf|refactor|üöÄ|üîß)" || echo "- Am√©liorations des performances")
          
          ### üåç Support Multilingue
          - 11 langues diff√©rentes support√©es: Turc, Anglais, Arabe, Allemand, Espagnol, Fran√ßais, Indon√©sien, Cor√©en, N√©erlandais, Russe, Chinois Traditionnel
          
          ### üì± Support des Plateformes
          - Android (API 23+)
          - iOS (iOS 12+)
          
          ---
          **Journal des modifications complet:** [CHANGELOG.MD](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.MD)
          EOF
          
          # Indonesian Release Notes
          cat > release_notes_id.md << EOF
          ## üöÄ Versi $VERSION
          
          ### ‚ú® Fitur Baru
          $(echo "$COMMITS" | grep -E "^(feat|‚ú®)" || echo "- Fitur baru ditambahkan")
          
          ### üêõ Perbaikan Bug
          $(echo "$COMMITS" | grep -E "^(fix|üêõ)" || echo "- Bug diperbaiki")
          
          ### üîß Peningkatan
          $(echo "$COMMITS" | grep -E "^(perf|refactor|üöÄ|üîß)" || echo "- Peningkatan performa")
          
          ### üåç Dukungan Multi Bahasa
          - 11 bahasa berbeda didukung: Turki, Inggris, Arab, Jerman, Spanyol, Prancis, Indonesia, Korea, Belanda, Rusia, Tionghoa Tradisional
          
          ### üì± Dukungan Platform
          - Android (API 23+)
          - iOS (iOS 12+)
          
          ---
          **Log perubahan lengkap:** [CHANGELOG.MD](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.MD)
          EOF
          
          # Korean Release Notes
          cat > release_notes_ko.md << EOF
          ## üöÄ Î≤ÑÏ†Ñ $VERSION
          
          ### ‚ú® ÏÉàÎ°úÏö¥ Í∏∞Îä•
          $(echo "$COMMITS" | grep -E "^(feat|‚ú®)" || echo "- ÏÉàÎ°úÏö¥ Í∏∞Îä•Ïù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§")
          
          ### üêõ Î≤ÑÍ∑∏ ÏàòÏ†ï
          $(echo "$COMMITS" | grep -E "^(fix|üêõ)" || echo "- Î≤ÑÍ∑∏Í∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§")
          
          ### üîß Í∞úÏÑ†ÏÇ¨Ìï≠
          $(echo "$COMMITS" | grep -E "^(perf|refactor|üöÄ|üîß)" || echo "- ÏÑ±Îä• Í∞úÏÑ†")
          
          ### üåç Îã§Íµ≠Ïñ¥ ÏßÄÏõê
          - 11Í∞ú Ïñ∏Ïñ¥ ÏßÄÏõê: ÌÑ∞ÌÇ§Ïñ¥, ÏòÅÏñ¥, ÏïÑÎûçÏñ¥, ÎèÖÏùºÏñ¥, Ïä§ÌéòÏù∏Ïñ¥, ÌîÑÎûëÏä§Ïñ¥, Ïù∏ÎèÑÎÑ§ÏãúÏïÑÏñ¥, ÌïúÍµ≠Ïñ¥, ÎÑ§ÎçúÎûÄÎìúÏñ¥, Îü¨ÏãúÏïÑÏñ¥, Î≤àÏ≤¥ Ï§ëÍµ≠Ïñ¥
          
          ### üì± ÌîåÎû´Ìèº ÏßÄÏõê
          - Android (API 23+)
          - iOS (iOS 12+)
          
          ---
          **Ï†ÑÏ≤¥ Î≥ÄÍ≤Ω Î°úÍ∑∏:** [CHANGELOG.MD](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.MD)
          EOF
          
          # Dutch Release Notes
          cat > release_notes_nl.md << EOF
          ## üöÄ Versie $VERSION
          
          ### ‚ú® Nieuwe Functies
          $(echo "$COMMITS" | grep -E "^(feat|‚ú®)" || echo "- Nieuwe functies toegevoegd")
          
          ### üêõ Bugfixes
          $(echo "$COMMITS" | grep -E "^(fix|üêõ)" || echo "- Bugs opgelost")
          
          ### üîß Verbeteringen
          $(echo "$COMMITS" | grep -E "^(perf|refactor|üöÄ|üîß)" || echo "- Prestatieverbeteringen")
          
          ### üåç Meertalige Ondersteuning
          - 11 verschillende talen ondersteund: Turks, Engels, Arabisch, Duits, Spaans, Frans, Indonesisch, Koreaans, Nederlands, Russisch, Traditioneel Chinees
          
          ### üì± Platformondersteuning
          - Android (API 23+)
          - iOS (iOS 12+)
          
          ---
          **Volledig wijzigingslogboek:** [CHANGELOG.MD](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.MD)
          EOF
          
          # Russian Release Notes
          cat > release_notes_ru.md << EOF
          ## üöÄ –í–µ—Ä—Å–∏—è $VERSION
          
          ### ‚ú® –ù–æ–≤—ã–µ –§—É–Ω–∫—Ü–∏–∏
          $(echo "$COMMITS" | grep -E "^(feat|‚ú®)" || echo "- –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏")
          
          ### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –û—à–∏–±–æ–∫
          $(echo "$COMMITS" | grep -E "^(fix|üêõ)" || echo "- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏")
          
          ### üîß –£–ª—É—á—à–µ–Ω–∏—è
          $(echo "$COMMITS" | grep -E "^(perf|refactor|üöÄ|üîß)" || echo "- –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏")
          
          ### üåç –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è –ü–æ–¥–¥–µ—Ä–∂–∫–∞
          - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 11 —è–∑—ã–∫–æ–≤: –¢—É—Ä–µ—Ü–∫–∏–π, –ê–Ω–≥–ª–∏–π—Å–∫–∏–π, –ê—Ä–∞–±—Å–∫–∏–π, –ù–µ–º–µ—Ü–∫–∏–π, –ò—Å–ø–∞–Ω—Å–∫–∏–π, –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π, –ò–Ω–¥–æ–Ω–µ–∑–∏–π—Å–∫–∏–π, –ö–æ—Ä–µ–π—Å–∫–∏–π, –ì–æ–ª–ª–∞–Ω–¥—Å–∫–∏–π, –†—É—Å—Å–∫–∏–π, –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π –ö–∏—Ç–∞–π—Å–∫–∏–π
          
          ### üì± –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ü–ª–∞—Ç—Ñ–æ—Ä–º
          - Android (API 23+)
          - iOS (iOS 12+)
          
          ---
          **–ü–æ–ª–Ω—ã–π –∂—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π:** [CHANGELOG.MD](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.MD)
          EOF
          
          # Chinese Release Notes
          cat > release_notes_zh.md << EOF
          ## üöÄ ÁâàÊú¨ $VERSION
          
          ### ‚ú® Êñ∞ÂäüËÉΩ
          $(echo "$COMMITS" | grep -E "^(feat|‚ú®)" || echo "- Êñ∞Â¢ûÂäüËÉΩ")
          
          ### üêõ ÈåØË™§‰øÆÂæ©
          $(echo "$COMMITS" | grep -E "^(fix|üêõ)" || echo "- ‰øÆÂæ©ÈåØË™§")
          
          ### üîß ÊîπÈÄ≤
          $(echo "$COMMITS" | grep -E "^(perf|refactor|üöÄ|üîß)" || echo "- ÊÄßËÉΩÊîπÈÄ≤")
          
          ### üåç Â§öË™ûË®ÄÊîØÊåÅ
          - ÊîØÊåÅ11Á®ÆË™ûË®ÄÔºöÂúüËÄ≥ÂÖ∂Ë™û„ÄÅËã±Ë™û„ÄÅÈòøÊãâ‰ºØË™û„ÄÅÂæ∑Ë™û„ÄÅË•øÁè≠ÁâôË™û„ÄÅÊ≥ïË™û„ÄÅÂç∞Â∞ºË™û„ÄÅÈüìË™û„ÄÅËç∑Ëò≠Ë™û„ÄÅ‰øÑË™û„ÄÅÁπÅÈ´î‰∏≠Êñá
          
          ### üì± Âπ≥Âè∞ÊîØÊåÅ
          - Android (API 23+)
          - iOS (iOS 12+)
          
          ---
          **ÂÆåÊï¥ËÆäÊõ¥Êó•Ë™åÔºö** [CHANGELOG.MD](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.MD)
          EOF
          
          # Set outputs
          echo "notes-en<<EOF" >> $GITHUB_OUTPUT
          cat release_notes_en.md >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          
          echo "notes-tr<<EOF" >> $GITHUB_OUTPUT
          cat release_notes_tr.md >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          
          echo "notes-ar<<EOF" >> $GITHUB_OUTPUT
          cat release_notes_ar.md >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          
          echo "notes-de<<EOF" >> $GITHUB_OUTPUT
          cat release_notes_de.md >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          
          echo "notes-es<<EOF" >> $GITHUB_OUTPUT
          cat release_notes_es.md >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          
          echo "notes-fr<<EOF" >> $GITHUB_OUTPUT
          cat release_notes_fr.md >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          
          echo "notes-id<<EOF" >> $GITHUB_OUTPUT
          cat release_notes_id.md >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          
          echo "notes-ko<<EOF" >> $GITHUB_OUTPUT
          cat release_notes_ko.md >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          
          echo "notes-nl<<EOF" >> $GITHUB_OUTPUT
          cat release_notes_nl.md >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          
          echo "notes-ru<<EOF" >> $GITHUB_OUTPUT
          cat release_notes_ru.md >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          
          echo "notes-zh<<EOF" >> $GITHUB_OUTPUT
          cat release_notes_zh.md >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

  deploy-android:
    needs: [build-android, generate-release-notes]
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Download App Bundle
        uses: actions/download-artifact@v4
        with:
          name: android-app-bundle-${{ github.sha }}
          path: .

      - name: Deploy to Google Play
        uses: r0adkll/upload-google-play@v1
        with:
          serviceAccountJsonPlainText: ${{ secrets.GOOGLE_PLAY_SERVICE_ACCOUNT_JSON }}
          packageName: ${{ env.BUNDLE_ID_ANDROID }}
          releaseFiles: app-release.aab
          track: production
          status: completed
          inAppUpdatePriority: 2
          releaseNotes: ${{ needs.generate-release-notes.outputs.release-notes-en }}

  # iOS development build for develop branch
  build-ios-development:
    needs: test
    runs-on: macos-latest
    if: github.ref == 'refs/heads/develop'

    steps:
      - uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          cache: true

      - name: Cache Flutter dependencies
        uses: actions/cache@v3
        with:
          path: |
            ~/.pub-cache
            **/.packages
            **/.flutter-plugins
            **/.flutter-plugin-dependencies
          key: ${{ runner.os }}-flutter-${{ hashFiles('**/pubspec.lock') }}
          restore-keys: |
            ${{ runner.os }}-flutter-

      - name: Install dependencies
        run: flutter pub get

      - name: Build iOS Development
        run: |
          cd ios
          flutter build ios --debug --no-codesign \
            --build-name=dev-${{ github.event.head_commit.id }} \
            --build-number=${{ github.run_number }}

      - name: Upload iOS Development Build
        uses: actions/upload-artifact@v4
        with:
          name: ios-development-build-${{ github.sha }}
          path: build/ios/iphoneos/Runner.app
          retention-days: 7

  # Development build notification
  notify-development-build:
    needs: [build-development, build-ios-development]
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/develop'

    steps:
      - name: Development Build Complete
        run: |
          echo "üöÄ Development build completed successfully!"
          echo "üì± Android APK and App Bundle are ready for testing"
          echo "üçé iOS build is ready for testing"
          echo "üîó Download artifacts from the Actions tab"
          echo "üìã Commit: ${{ github.sha }}"
          echo "üåø Branch: develop"

  # iOS deployment notification with multilanguage notes
  notify-ios-deploy:
    needs: [test, generate-release-notes]
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Create iOS Release Notes Files
        run: |
          mkdir -p ios_release_notes
          
          # Create release notes files for each language
          echo "${{ needs.generate-release-notes.outputs.release-notes-en }}" > ios_release_notes/release_notes_en.txt
          echo "${{ needs.generate-release-notes.outputs.release-notes-tr }}" > ios_release_notes/release_notes_tr.txt
          echo "${{ needs.generate-release-notes.outputs.release-notes-ar }}" > ios_release_notes/release_notes_ar.txt
          echo "${{ needs.generate-release-notes.outputs.release-notes-de }}" > ios_release_notes/release_notes_de.txt
          echo "${{ needs.generate-release-notes.outputs.release-notes-es }}" > ios_release_notes/release_notes_es.txt
          echo "${{ needs.generate-release-notes.outputs.release_notes-fr }}" > ios_release_notes/release_notes_fr.txt
          echo "${{ needs.generate-release-notes.outputs.release-notes-id }}" > ios_release_notes/release_notes_id.txt
          echo "${{ needs.generate-release-notes.outputs.release-notes-ko }}" > ios_release_notes/release_notes_ko.txt
          echo "${{ needs.generate-release-notes.outputs.release-notes-nl }}" > ios_release_notes/release_notes_nl.txt
          echo "${{ needs.generate-release-notes.outputs.release-notes-ru }}" > ios_release_notes/release_notes_ru.txt
          echo "${{ needs.generate-release-notes.outputs.release-notes-zh }}" > ios_release_notes/release_notes_zh.txt
          
          echo "üì± iOS release notes created for all 11 languages!"
          echo "üçé Use these files with your Fastlane deployment:"
          echo "cd ios && fastlane release"

      - name: Upload iOS Release Notes
        uses: actions/upload-artifact@v4
        with:
          name: ios-release-notes-${{ github.sha }}
          path: ios_release_notes/
          retention-days: 30

  # Create GitHub Release with multilanguage notes
  create-github-release:
    needs: [build-android, generate-release-notes]
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/tags/v')

    steps:
      - name: Download Android APK
        uses: actions/download-artifact@v4
        with:
          name: android-apk-${{ github.sha }}
          path: ./artifacts/

      - name: Create GitHub Release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref_name }}
          release_name: Sara Baby Tracker ${{ github.ref_name }}
          body: ${{ needs.generate-release-notes.outputs.release-notes-en }}
          draft: false
          prerelease: false
          files: |
            ./artifacts/app-release.apk